angular.module("fg.modal",["ngAnimate"]).factory("ModalTemplate",["$document","$compile","$rootScope","$http","$templateCache","$q","$animate","$injector","$controller",function(e,t,n,r,o,s,i,l,a){function c(e){this.templateUrl=e.templateUrl,this.template=e.template,this.containerUrl=e.containerUrl,this.defaults=e.defaults||{},this.controller=e.controller,this.controllerAs=e.controllerAs,this["class"]=e["class"],this.resolve=e.resolve||{}}function d(){this.$$deferredEvents={accept:s.defer(),dismiss:s.defer(),destroy:s.defer()},this.$$eventListeners={link:[],accept:[],dismiss:[],destroy:[]},this.$$pendingEvents=[]}var h=null,u=!0,$=n.$new(),p=[];$.loadingTemplateUrl=h;var f=t(angular.element(['<div class="fg-modal-wrapper fg-modal-dropzone ng-hide" ng-show="show">','<div ng-show="loading" ng-include="loadingTemplateUrl"></div>',"</div>"].join("")))($);d.prototype.$$trigger=function(e){this.$$eventListeners[e].forEach(function(e){e()})},d.prototype.$$resolve=function(e){var t=this,n=t.$$deferredEvents[e];if(this.$$pendingEvents.indexOf(e)>-1)return n.promise;this.$$pendingEvents.push(e);var r=t.$$eventListeners[e],o=r.map(function(e){return s.when(e())});return s.all(o).then(function(){return n.resolve(),n.promise},function(n){var r=t.$$pendingEvents.indexOf(e);return t.$$pendingEvents.splice(r,1),s.reject(n)})},d.prototype.accept=function(){this.$$resolve("accept").then(this.destroy.bind(this))},d.prototype.dismiss=function(){return this.$$resolve("dismiss").then(this.destroy.bind(this))};var m=function(){return i.leave(this.$element)},v=function(){var e=this,t=_.findIndex(p,function(t){return t.$scope.$$id===e.$scope.$$id});p.splice(t,1),$.show=p.length,e.$scope.$destroy()},g=function(){var e=this.$$deferredEvents;e.accept.reject(),e.dismiss.reject()};return d.prototype.destroy=function(){return this.$$resolve("destroy").then(m.bind(this)).then(v.bind(this)).then(g.bind(this)).then(this.$$deferredEvents.destroy.resolve)},d.prototype.when=function(e){return this.$$deferredEvents[e].promise},d.prototype.on=function(e,t){if(Array.isArray(t))return t.forEach(this.on.bind(this,e));var n=this;return e.split(" ").forEach(function(e){n.$$eventListeners[e].push(t.bind(n))}),n},e.find("body").append(f),f.on("mouseup",function(e){angular.element(e.target).hasClass("fg-modal-dropzone")&&p.forEach(function(e){e.dismiss()})}),c.prototype.render=function(e){var c=new d,h=this,m=h.containerUrl;e=e||{},e=e.constructor!==n.constructor?angular.extend($.$new(),e):e.$new(),e.$modal=c,$.loading=!$.show&&u,$.show=$.show||u;var v={locals:s.all(Object.keys(h.resolve).reduce(function(e,t){return e[t]=s.when(l.invoke(h.resolve[t])),e},{$scope:e,$modal:c})),template:s.when(h.template||r({method:"GET",cache:o,url:h.templateUrl,type:"text/html"}))};return m&&(v.container=s.when(h.container||r({method:"GET",cache:o,url:h.containerUrl,type:"text/html"}))),s.all(v).then(function(n){var r,o=function(e){return angular.element(e).addClass("fg-modal")},s=o(m?n.container.data:n.template.data),l=m&&{parentBoundTranscludeFn:function(r,o){t(n.template.data)(e,o)}},d=function(t,o){c.$scope=e,h.controller&&(r=a(h.controller,n.locals)),$.loading=!1,$.show=!0,h.controllerAs&&(e[h.controllerAs]=r);var s=_.last(p);i.enter(t,f,s&&s.$element),c.$element=t,p.unshift(c),c.$$trigger("link")};t(s)(e,d,l)}),Object.keys(h.defaults).forEach(function(e){var t=h.defaults[e];t&&(Array.isArray(t)?t:[t]).forEach(function(t){c.on(e,t)})}),c},c}]);