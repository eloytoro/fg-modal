angular.module("fg.modal",["ngAnimate"]).provider("Modal",function(){var e=function(e,n){this.templateUrl=n.templateUrl,this.template=n.template,this.defaults=n.defaults||{},this.controller=n.controller,this.controllerAs=n.controllerAs,this["class"]=n["class"],this.resolve=n.resolve||{},this.name=e},n={},t=this;this.modal=function(o,r){return n[o]=function(n){var t=n.invoke(r);return new e(o,t)},t},this.loadingTemplateUrl=null,this.loadingMask=!0,this.$get=["$document","$compile","$rootScope","$http","$templateCache","$q","$animate","$injector","$controller",function(o,r,i,l,s,a,c,d,u){function h(e){var n=this,t={accept:a.defer(),dismiss:a.defer(),destroy:a.defer()},o={link:[],overlay:[],conceal:[],accept:[],dismiss:[],destroy:[]},r=function(e){return a.all(o[e].map(function(e){return a.when(e())})).then(function(){return t[e].resolve(),t[e].promise})},i=function(e){o[e].forEach(function(e){e()})};this.$template=e,this.$index=0,this.accept=function(){return r("accept").then(n.destroy)},this.dismiss=function(){return r("dismiss").then(n.destroy)},this.destroy=function(){return r("destroy").then(function(){var e=p.indexOf(n);p.splice(e,1),n.$element.remove(),p.forEach(function(e){e.$index>n.$index&&e.overlay()}),m.show=p.length,n.$scope.$destroy()})},this.when=function(e){return t[e].promise},this.overlay=function(){0!==n.$index&&(n.$element.css("z-index","+=1"),n.$index--,i("overlay"))},this.conceal=function(){n.$element.css("z-index","-=1"),n.$index++,i("conceal")},this.on=function(e,t){return e.split(" ").forEach(function(e){o[e].push(t.bind(n))}),n},this.$$trigger=i}Object.keys(n).forEach(function(e){n[e]=n[e](d)});var f,m=i.$new(),p=[];m.loadingTemplateUrl=t.loadingTemplateUrl;var f=r(angular.element(['<div class="fg-modal-wrapper fg-modal-dropzone ng-hide" ng-show="show">','<div ng-show="loading" ng-include="loadingTemplateUrl"></div>',"</div>"].join("")))(m);o.find("body").append(f),f.on("mouseup",function(e){if(angular.element(e.target).hasClass("fg-modal-dropzone")){var n=$.list()[0];n&&n.dismiss()}}),e.prototype.pop=function(e){var n=new h(this);e=e||{},e=e.$id?e.$new():Object.keys(e).reduce(function(n,t){return n[t]=e[t],n},m.$new()),e.$modal=n;var o=this;return m.loading=!m.show&&t.loadingMask,m.show=m.show||t.loadingMask,a.all({locals:a.all(Object.keys(this.resolve).reduce(function(e,n){return e[n]=a.when(d.invoke(o.resolve[n])),e},{$scope:e,$modal:n})),template:a.when(this.template||l({method:"GET",cache:s,url:this.templateUrl,type:"text/html"}))}).then(function(t){var i=angular.element(t.template.data).addClass("fg-modal");o["class"]&&i.addClass(o["class"]);var l;i=r(i)(e),n.$scope=e,o.controller&&(l=u(o.controller,t.locals)),m.loading=!1,m.show=!0,o.controllerAs&&(e[o.controllerAs]=l),f.append(i),n.$element=i,p.forEach(function(e){e.conceal()}),p.unshift(n),n.$$trigger("link")}),Object.keys(this.defaults).forEach(function(e){var t=o.defaults[e];(t instanceof Array?t:[t]).forEach(function(t){n.on(e,t)})}),n};var $=function(e){return e?n[e]:p[0]};return $.list=function(){return p.sort(function(e,n){return e.$index>n.$index})},$}]});